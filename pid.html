
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lecture 1: (PID) Control &#8212; Interactive Control Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/chat.css?v=16a4e30f" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pid';</script>
    <script src="_static/inverted-pendulum.js?v=e453125a"></script>
    <script src="_static/chat.js?v=2af54417"></script>
    <script src="_static/fixed-simulation.js?v=1c732286"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interactive PID Simulation" href="simulation.html" />
    <link rel="prev" title="🚀 Student Guide" href="student-guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Interactive Control Lab</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    🎯 Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="student-guide.html">🚀 Student Guide</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 1: (PID) Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Interactive PID Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercises.html">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References &amp; Further Reading</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/suann124/AIinTeaching/main?urlpath=lab/tree/./pid.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/pid.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="_sources/pid.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 1: (PID) Control</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proportional-integral-derivative-pid-control-structure">1. Proportional-Integral-Derivative (PID) Control Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-function-representation">2. Transfer Function Representation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-proportional-only-control">3. Analysis of Proportional-Only Control</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-integral-action">4. Effect of Integral Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-derivative-action">5. Effect of Derivative Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implementation-considerations">6. Practical Implementation Considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worked-example-first-order-plant">7. Worked Example: First-Order Plant</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interactive-simulation-example">8. Interactive Simulation Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-understanding-p-i-d-effects-on-a-second-order-plant">9. Experiment: Understanding P, I, D effects on a second-order plant</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-proportional-only-control">Step 1: Proportional-only control</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-adding-integral-action-pi-control">Step 2: Adding integral action (PI control)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-adding-derivative-action-full-pid">Step 3: Adding derivative action (full PID)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-frequency-domain-analysis">Step 4: Frequency domain analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-manual-tuning-recipe">10. A simple manual tuning recipe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-pid-you-can-paste-into-projects">11. Discrete PID you can paste into projects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-pitfalls-and-quick-fixes">12. Common pitfalls (and quick fixes)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-1-pid-control">
<span id="pid"></span><h1>Lecture 1: (PID) Control<a class="headerlink" href="#lecture-1-pid-control" title="Link to this heading">#</a></h1>
<div class="tip admonition">
<p class="admonition-title">What you will learn</p>
<ul class="simple">
<li><p><strong>PID controller structure</strong> and transfer function representation</p></li>
<li><p><strong>Closed-loop analysis</strong> using transfer functions <span class="math notranslate nohighlight">\(G_{ry}(s)\)</span></p></li>
<li><p>Effects of <strong>P</strong>, <strong>I</strong>, <strong>D</strong> terms on steady-state error and transient response</p></li>
<li><p><strong>Disturbance rejection</strong> properties of integral action</p></li>
<li><p><strong>Practical implementation</strong> considerations and discrete-time forms</p></li>
<li><p><strong>Manual tuning</strong> strategies based on closed-loop characteristics</p></li>
</ul>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p><strong>Original slides</strong>: <a class="reference download internal" download="" href="_downloads/a78851ec228cb70f242f7f4d7690c67a/pid.pdf"><code class="xref download docutils literal notranslate"><span class="pre">PID</span> <span class="pre">lecture</span> <span class="pre">PDF</span></code></a><br />
The PDF is embedded below for quick reference.</p>
</aside>
<object data="_static/pid.pdf" type="application/pdf" width="100%" height="520px">
  <p>PDF preview unavailable. <a href="_static/pid.pdf">Open the PDF.</a></p>
</object><hr class="docutils" />
<section id="proportional-integral-derivative-pid-control-structure">
<h2>1. Proportional-Integral-Derivative (PID) Control Structure<a class="headerlink" href="#proportional-integral-derivative-pid-control-structure" title="Link to this heading">#</a></h2>
<p>Consider the standard unity feedback control system where we want the plant output <span class="math notranslate nohighlight">\(y(t)\)</span> to track a reference signal <span class="math notranslate nohighlight">\(r(t)\)</span>. The <strong>error signal</strong> is defined as:</p>
<div class="math notranslate nohighlight">
\[e(t) = r(t) - y(t)\]</div>
<p>The PID controller computes the control input as:</p>
<div class="math notranslate nohighlight">
\[u(t) = k_p e(t) + k_i \int_0^t e(\tau)d\tau + k_d \frac{de(t)}{dt}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><strong>Proportional term</strong>: <span class="math notranslate nohighlight">\(k_p e(t)\)</span> depends on the instantaneous error value</p></li>
<li><p><strong>Integral term</strong>: <span class="math notranslate nohighlight">\(k_i \int_0^t e(\tau)d\tau\)</span> is based on the integral of error up to time <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p><strong>Derivative term</strong>: <span class="math notranslate nohighlight">\(k_d \frac{de(t)}{dt}\)</span> provides an estimate of the future error</p></li>
</ul>
<figure class="align-center" id="fig-pid-structure">
<img alt="https://dummyimage.com/880x150/ffffff/000000.png&amp;text=r+--&gt;(+)+--+--&gt;+PID+Controller+--&gt;+Plant+P(s)+--&gt;+y(t);+(-)+feedback" src="https://dummyimage.com/880x150/ffffff/000000.png&amp;text=r+--&gt;(+)+--+--&gt;+PID+Controller+--&gt;+Plant+P(s)+--&gt;+y(t);+(-)+feedback" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Unity feedback system with PID controller</span><a class="headerlink" href="#fig-pid-structure" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="transfer-function-representation">
<h2>2. Transfer Function Representation<a class="headerlink" href="#transfer-function-representation" title="Link to this heading">#</a></h2>
<p>Taking the Laplace transform (assuming zero initial conditions), the <strong>controller transfer function</strong> from error <span class="math notranslate nohighlight">\(e\)</span> to control input <span class="math notranslate nohighlight">\(u\)</span> is:</p>
<div class="math notranslate nohighlight">
\[C(s) = k_p + \frac{k_i}{s} + k_d s\]</div>
<p>For a plant with transfer function <span class="math notranslate nohighlight">\(P(s)\)</span>, the <strong>closed-loop transfer function</strong> from reference <span class="math notranslate nohighlight">\(r\)</span> to output <span class="math notranslate nohighlight">\(y\)</span> is:</p>
<div class="math notranslate nohighlight">
\[G_{ry}(s) = \frac{P(s)C(s)}{1 + P(s)C(s)}\]</div>
<p><strong>Key insight</strong>: The steady-state gain of a stable transfer function <span class="math notranslate nohighlight">\(H(s)\)</span> under unit step input is <span class="math notranslate nohighlight">\(H(0)\)</span>.</p>
</section>
<hr class="docutils" />
<section id="analysis-of-proportional-only-control">
<h2>3. Analysis of Proportional-Only Control<a class="headerlink" href="#analysis-of-proportional-only-control" title="Link to this heading">#</a></h2>
<p>Consider <strong>pure proportional feedback</strong> with <span class="math notranslate nohighlight">\(k_i = 0\)</span> and <span class="math notranslate nohighlight">\(k_d = 0\)</span>, so <span class="math notranslate nohighlight">\(C(s) = k_p\)</span>.</p>
<p>The steady-state output due to a unit step reference input is:</p>
<div class="math notranslate nohighlight">
\[y_{ss} = G_{ry}(0) \cdot 1 = \frac{C(0)P(0)}{1 + C(0)P(0)} = \frac{k_p P(0)}{1 + k_p P(0)}\]</div>
<p><strong>Key observations:</strong></p>
<ul class="simple">
<li><p><strong>Steady-state error exists</strong>: <span class="math notranslate nohighlight">\(e_{ss} = 1 - y_{ss} = \frac{1}{1 + k_p P(0)}\)</span></p></li>
<li><p><strong>Error decreases</strong> as <span class="math notranslate nohighlight">\(k_p\)</span> increases, but <strong>never reaches zero</strong></p></li>
<li><p><strong>Trade-off</strong>: Larger <span class="math notranslate nohighlight">\(k_p\)</span> reduces steady-state error but can cause overshoot and oscillations</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="effect-of-integral-action">
<h2>4. Effect of Integral Action<a class="headerlink" href="#effect-of-integral-action" title="Link to this heading">#</a></h2>
<p>Now consider <strong>PI control</strong> with <span class="math notranslate nohighlight">\(C(s) = k_p + \frac{k_i}{s}\)</span>.</p>
<p>The closed-loop transfer function becomes:</p>
<div class="math notranslate nohighlight">
\[G_{ry}(s) = \frac{\left(k_p + \frac{k_i}{s}\right) P(s)}{1 + \left(k_p + \frac{k_i}{s}\right) P(s)} = \frac{(k_p s + k_i) P(s)}{s + P(s)(k_p s + k_i)}\]</div>
<p>For steady-state analysis with unit step reference:</p>
<div class="math notranslate nohighlight">
\[G_{ry}(0) = \frac{k_i P(0)}{k_i P(0)} = 1\]</div>
<p><strong>Key results:</strong></p>
<ul class="simple">
<li><p><strong>Perfect reference tracking</strong>: <span class="math notranslate nohighlight">\(y_{ss} = 1\)</span> regardless of plant parameters</p></li>
<li><p><strong>Zero steady-state error</strong>: Independent of plant gain <span class="math notranslate nohighlight">\(P(0)\)</span></p></li>
<li><p><strong>Trade-off</strong>: Higher <span class="math notranslate nohighlight">\(k_i\)</span> speeds convergence but increases oscillations</p></li>
</ul>
<p><strong>Disturbance rejection</strong>: With only integral action <span class="math notranslate nohighlight">\(C(s) = k_i/s\)</span>, the transfer function from step disturbance <span class="math notranslate nohighlight">\(d\)</span> to output is:</p>
<div class="math notranslate nohighlight">
\[G_{dy}(s) = \frac{P(s)}{1 + P(s)C(s)} \Rightarrow G_{dy}(0) = 0\]</div>
<p>This gives <strong>perfect disturbance rejection</strong> at steady-state.</p>
</section>
<hr class="docutils" />
<section id="effect-of-derivative-action">
<h2>5. Effect of Derivative Action<a class="headerlink" href="#effect-of-derivative-action" title="Link to this heading">#</a></h2>
<p>Adding the derivative term gives full <strong>PID control</strong>: <span class="math notranslate nohighlight">\(C(s) = k_p + \frac{k_i}{s} + k_d s\)</span>.</p>
<p><strong>Key insight</strong>: The derivative term acts on the rate of change of error, effectively providing a “prediction” of future error and helping to “brake” the system response.</p>
<p><strong>Damping effect</strong>: Consider a second-order plant with natural frequency <span class="math notranslate nohighlight">\(\omega_n\)</span> and damping ratio <span class="math notranslate nohighlight">\(\zeta\)</span>. Adding derivative control with gain <span class="math notranslate nohighlight">\(k_d\)</span> modifies the closed-loop damping:</p>
<div class="math notranslate nohighlight">
\[\zeta_{new} = \zeta + \frac{k_d \omega_n}{2}\]</div>
<p><strong>Benefits of derivative action:</strong></p>
<ul class="simple">
<li><p><strong>Reduces overshoot</strong> and oscillations in step response</p></li>
<li><p><strong>Improves stability margins</strong> and transient performance</p></li>
<li><p><strong>Provides faster settling</strong> without increasing steady-state error</p></li>
</ul>
<p><strong>Limitations:</strong></p>
<ul class="simple">
<li><p><strong>Amplifies high-frequency noise</strong> due to differentiation</p></li>
<li><p><strong>No effect on steady-state</strong> behavior (since <span class="math notranslate nohighlight">\(\lim_{s \to 0} k_d s = 0\)</span>)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="practical-implementation-considerations">
<h2>6. Practical Implementation Considerations<a class="headerlink" href="#practical-implementation-considerations" title="Link to this heading">#</a></h2>
<p><strong>Derivative filtering</strong>: In practice, pure differentiation amplifies noise. Use a filtered derivative:</p>
<div class="math notranslate nohighlight">
\[C(s) = k_p + \frac{k_i}{s} + \frac{k_d s}{1 + \tau_d s}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau_d\)</span> is a small time constant (typically <span class="math notranslate nohighlight">\(\tau_d = k_d/N\)</span> with <span class="math notranslate nohighlight">\(N \in [5,20]\)</span>).</p>
<p><strong>Integral windup</strong>: When actuators saturate, the integrator can accumulate large values leading to poor transient response. <strong>Anti-windup schemes</strong> prevent this by stopping integration when saturation occurs.</p>
<p><strong>Digital implementation</strong>: For sampling time <span class="math notranslate nohighlight">\(\Delta t\)</span>, use approximations:</p>
<ul class="simple">
<li><p><strong>Integral</strong>: Trapezoidal rule for better accuracy</p></li>
<li><p><strong>Derivative</strong>: Backward difference with filtering for noise rejection</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="worked-example-first-order-plant">
<h2>7. Worked Example: First-Order Plant<a class="headerlink" href="#worked-example-first-order-plant" title="Link to this heading">#</a></h2>
<p>Consider a simple first-order plant: <span class="math notranslate nohighlight">\(P(s) = \frac{1}{s+1}\)</span> and analyze the effect of different controller structures.</p>
<p><strong>P-only control</strong>: <span class="math notranslate nohighlight">\(C(s) = k_p\)</span></p>
<p>Closed-loop transfer function: <span class="math notranslate nohighlight">\(G_{ry}(s) = \frac{k_p}{s + 1 + k_p}\)</span></p>
<p>Steady-state value for unit step: <span class="math notranslate nohighlight">\(y_{ss} = \frac{k_p}{1 + k_p}\)</span></p>
<p><strong>PI control</strong>: <span class="math notranslate nohighlight">\(C(s) = k_p + \frac{k_i}{s}\)</span></p>
<p>Closed-loop transfer function: <span class="math notranslate nohighlight">\(G_{ry}(s) = \frac{k_p s + k_i}{s^2 + (1+k_p)s + k_i}\)</span></p>
<p>Steady-state value for unit step: <span class="math notranslate nohighlight">\(y_{ss} = 1\)</span> (perfect tracking)</p>
<p>The poles are at <span class="math notranslate nohighlight">\(s = \frac{-(1+k_p) \pm \sqrt{(1+k_p)^2 - 4k_i}}{2}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pid_discrete</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">Kp</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">tau_d</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">umin</span><span class="o">=-</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">umax</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">Taw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    One PID update with filtered D and back-calculation anti-windup.</span>
<span class="sd">    st = dict(integ, prev_e, d_filt)</span>
<span class="sd">    Returns (u, st)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">integ</span><span class="p">,</span> <span class="n">prev_e</span><span class="p">,</span> <span class="n">d_filt</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="s2">&quot;integ&quot;</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="s2">&quot;prev_e&quot;</span><span class="p">],</span> <span class="n">st</span><span class="p">[</span><span class="s2">&quot;d_filt&quot;</span><span class="p">]</span>

    <span class="c1"># trapezoidal integral</span>
    <span class="n">integ</span> <span class="o">=</span> <span class="n">integ</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="n">prev_e</span><span class="p">)</span>

    <span class="c1"># filtered derivative</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">tau_d</span><span class="o">/</span><span class="p">(</span><span class="n">tau_d</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span> <span class="k">if</span> <span class="n">tau_d</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">d_raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">prev_e</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span> <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">d_filt</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">d_filt</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">d_raw</span>

    <span class="n">u_raw</span> <span class="o">=</span> <span class="n">Kp</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">Ki</span><span class="o">*</span><span class="n">integ</span> <span class="o">+</span> <span class="n">Kd</span><span class="o">*</span><span class="n">d_filt</span>

    <span class="c1"># saturation and anti-windup</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">umin</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">umax</span><span class="p">,</span> <span class="n">u_raw</span><span class="p">))</span>
    <span class="n">integ</span> <span class="o">+=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_raw</span><span class="p">)</span><span class="o">/</span><span class="n">Taw</span>  <span class="c1"># back-calculation</span>

    <span class="n">st</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;integ&quot;</span><span class="p">:</span> <span class="n">integ</span><span class="p">,</span> <span class="s2">&quot;prev_e&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span> <span class="s2">&quot;d_filt&quot;</span><span class="p">:</span> <span class="n">d_filt</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">st</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="interactive-simulation-example">
<h2>8. Interactive Simulation Example<a class="headerlink" href="#interactive-simulation-example" title="Link to this heading">#</a></h2>
<p>Consider <span class="math notranslate nohighlight">\(x_{k+1} = x_k + \Delta t [a (u_k - x_k)]\)</span><br />
(a leaky bucket / first-order lag with rate <span class="math notranslate nohighlight">\(a\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">simulate_pid_first_order</span><span class="p">(</span><span class="n">Kp</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                             <span class="n">ref</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">umin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">umax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">Taw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;integ&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;prev_e&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;d_filt&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">us</span><span class="p">,</span> <span class="n">es</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">dt</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">ref</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="n">pid_discrete</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tau_d</span><span class="p">,</span> <span class="n">umin</span><span class="p">,</span> <span class="n">umax</span><span class="p">,</span> <span class="n">Taw</span><span class="p">)</span>
        <span class="c1"># plant update</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">);</span> <span class="n">es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">us</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>

<span class="n">ts</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">us</span><span class="p">,</span> <span class="n">es</span> <span class="o">=</span> <span class="n">simulate_pid_first_order</span><span class="p">()</span>
<span class="nb">float</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.771896401117652, 0.7779050672376774)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot (matplotlib is available in most Jupyter installs)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x (output)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Step response with PID&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">us</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;u (control)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Control effort (with saturation)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da80298111d878cd6df932eac9e9b45dff58f247a0eb9b49fe171a5d2b6e1c59.png" src="_images/da80298111d878cd6df932eac9e9b45dff58f247a0eb9b49fe171a5d2b6e1c59.png" />
<img alt="_images/fd2badc1893b87c46bced7e74d40b0b3c2a711efe078e5e99baad0354adb9023.png" src="_images/fd2badc1893b87c46bced7e74d40b0b3c2a711efe078e5e99baad0354adb9023.png" />
</div>
</div>
<p><strong>Try this:</strong> increase <span class="math notranslate nohighlight">\(K_p\)</span> (faster but overshoot), add <span class="math notranslate nohighlight">\(K_d\)</span> (damps overshoot), then raise <span class="math notranslate nohighlight">\(K_i\)</span> (remove any residual bias, watch for windup).</p>
</section>
<hr class="docutils" />
<section id="experiment-understanding-p-i-d-effects-on-a-second-order-plant">
<h2>9. Experiment: Understanding P, I, D effects on a second-order plant<a class="headerlink" href="#experiment-understanding-p-i-d-effects-on-a-second-order-plant" title="Link to this heading">#</a></h2>
<p>Let’s explore how each PID term affects system behavior using a <strong>mass-spring-damper</strong> system (common in mechanical control). The plant transfer function is:</p>
<div class="math notranslate nohighlight">
\[G_p(s) = \frac{\omega_n^2}{s^2 + 2\zeta\omega_n s + \omega_n^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(\omega_n = 2\)</span> rad/s is the natural frequency and <span class="math notranslate nohighlight">\(\zeta = 0.1\)</span> is the damping ratio (lightly damped).</p>
<section id="step-1-proportional-only-control">
<h3>Step 1: Proportional-only control<a class="headerlink" href="#step-1-proportional-only-control" title="Link to this heading">#</a></h3>
<p>First, let’s see what happens with <strong>P-only</strong> control (<span class="math notranslate nohighlight">\(K_i = 0\)</span>, <span class="math notranslate nohighlight">\(K_d = 0\)</span>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="c1"># Plant: underdamped second-order system</span>
<span class="n">wn</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># natural frequency</span>
<span class="n">zeta</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># damping ratio</span>
<span class="n">num_p</span> <span class="o">=</span> <span class="p">[</span><span class="n">wn</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
<span class="n">den_p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">zeta</span><span class="o">*</span><span class="n">wn</span><span class="p">,</span> <span class="n">wn</span><span class="o">**</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Gp</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">num_p</span><span class="p">,</span> <span class="n">den_p</span><span class="p">)</span>

<span class="c1"># Time vector</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply_tf</span><span class="p">(</span><span class="n">tf1</span><span class="p">,</span> <span class="n">tf2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two transfer functions manually&quot;&quot;&quot;</span>
    <span class="c1"># (n1/d1) * (n2/d2) = (n1*n2)/(d1*d2)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">tf1</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">tf2</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polymul</span><span class="p">(</span><span class="n">tf1</span><span class="o">.</span><span class="n">den</span><span class="p">,</span> <span class="n">tf2</span><span class="o">.</span><span class="n">den</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate closed-loop transfer function T = GcGp/(1+GcGp)&quot;&quot;&quot;</span>
    <span class="c1"># First multiply Gc * Gp</span>
    <span class="n">GcGp</span> <span class="o">=</span> <span class="n">multiply_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    
    <span class="c1"># T = GcGp / (1 + GcGp)</span>
    <span class="c1"># This means T = GcGp.num / (GcGp.den + GcGp.num)</span>
    <span class="n">num_cl</span> <span class="o">=</span> <span class="n">GcGp</span><span class="o">.</span><span class="n">num</span>
    <span class="n">den_cl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyadd</span><span class="p">(</span><span class="n">GcGp</span><span class="o">.</span><span class="n">den</span><span class="p">,</span> <span class="n">GcGp</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">num_cl</span><span class="p">,</span> <span class="n">den_cl</span><span class="p">)</span>

<span class="c1"># Test different Kp values</span>
<span class="n">Kp_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">Kp</span> <span class="ow">in</span> <span class="n">Kp_values</span><span class="p">:</span>
    <span class="c1"># P-only controller</span>
    <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Closed-loop transfer function T(s) = GcGp/(1+GcGp)</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    
    <span class="c1"># Step response</span>
    <span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Kp = </span><span class="si">{</span><span class="n">Kp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;P-only Control: Effect of Increasing Kp&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Show steady-state error for each case</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Steady-state values (should be 1.0 for perfect tracking):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Kp</span> <span class="ow">in</span> <span class="n">Kp_values</span><span class="p">:</span>
    <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="n">ss_value</span> <span class="o">=</span> <span class="n">y_step</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ss_error</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">ss_value</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kp = </span><span class="si">{</span><span class="n">Kp</span><span class="si">}</span><span class="s2">: SS value = </span><span class="si">{</span><span class="n">ss_value</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, SS error = </span><span class="si">{</span><span class="n">ss_error</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f3ecdd45900e1cdd2e63a4944e61229bd0fd23eed7177a3a269dcc52a57071ab.png" src="_images/f3ecdd45900e1cdd2e63a4944e61229bd0fd23eed7177a3a269dcc52a57071ab.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Steady-state values (should be 1.0 for perfect tracking):
Kp = 0.5: SS value = 0.278, SS error = 0.722
Kp = 1.0: SS value = 0.588, SS error = 0.412
Kp = 2.0: SS value = 0.773, SS error = 0.227
Kp = 4.0: SS value = 0.868, SS error = 0.132
</pre></div>
</div>
</div>
</div>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>Higher <span class="math notranslate nohighlight">\(K_p\)</span> → faster response but more overshoot</p></li>
<li><p><strong>Steady-state error remains</strong> (P-only cannot eliminate it for step inputs)</p></li>
<li><p>Too high <span class="math notranslate nohighlight">\(K_p\)</span> → system becomes oscillatory/unstable</p></li>
</ul>
</section>
<section id="step-2-adding-integral-action-pi-control">
<h3>Step 2: Adding integral action (PI control)<a class="headerlink" href="#step-2-adding-integral-action-pi-control" title="Link to this heading">#</a></h3>
<p>Now add integral action to eliminate steady-state error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PI Controller: Gc(s) = Kp + Ki/s</span>
<span class="n">Kp</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Fixed proportional gain</span>
<span class="n">Ki_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="n">Ki_values</span><span class="p">:</span>
    <span class="c1"># PI controller</span>
    <span class="k">if</span> <span class="n">Ki</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;P-only (Ki = 0)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Kp + Ki/s = (Kp*s + Ki)/s</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;PI (Ki = </span><span class="si">{</span><span class="n">Ki</span><span class="si">}</span><span class="s1">)&#39;</span>
    
    <span class="c1"># Closed-loop</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PI Control: Effect of Adding Integral Action&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Check final values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final values with PI control:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Ki</span> <span class="ow">in</span> <span class="n">Ki_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>  <span class="c1"># Skip Ki=0 case</span>
    <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ki = </span><span class="si">{</span><span class="n">Ki</span><span class="si">}</span><span class="s2">: Final value = </span><span class="si">{</span><span class="n">y_step</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1daf0fb43c7575ec9fb15b0fe4959b2d563ea754cb92108d57916f1c04362200.png" src="_images/1daf0fb43c7575ec9fb15b0fe4959b2d563ea754cb92108d57916f1c04362200.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final values with PI control:
Ki = 0.5: Final value = 1.183855
Ki = 1.0: Final value = 1.643254
Ki = 2.0: Final value = 3.315720
</pre></div>
</div>
</div>
</div>
<p><strong>Key insight:</strong> Integral action eliminates steady-state error but can make the response slower and more oscillatory.</p>
</section>
<section id="step-3-adding-derivative-action-full-pid">
<h3>Step 3: Adding derivative action (full PID)<a class="headerlink" href="#step-3-adding-derivative-action-full-pid" title="Link to this heading">#</a></h3>
<p>Finally, add derivative action to improve transient response:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PID Controller: Gc(s) = Kp + Ki/s + Kd*s</span>
<span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>  <span class="c1"># Fixed P and I gains</span>
<span class="n">Kd_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">Kd</span> <span class="ow">in</span> <span class="n">Kd_values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Kd</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># PI only</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;PI (Kd = 0)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Kp + Ki/s + Kd*s = (Kd*s^2 + Kp*s + Ki)/s</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kd</span><span class="p">,</span> <span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;PID (Kd = </span><span class="si">{</span><span class="n">Kd</span><span class="si">}</span><span class="s1">)&#39;</span>
    
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">y_step</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID Control: Effect of Adding Derivative Action&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Performance metrics</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance comparison (overshoot, settling time):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Kd</span> <span class="ow">in</span> <span class="n">Kd_values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Kd</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">controller_type</span> <span class="o">=</span> <span class="s2">&quot;PI&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Gc</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kd</span><span class="p">,</span> <span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">controller_type</span> <span class="o">=</span> <span class="s2">&quot;PID&quot;</span>
    
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">y_step</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Find overshoot</span>
    <span class="n">peak_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_step</span><span class="p">)</span>
    <span class="n">overshoot</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak_value</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># percentage</span>
    
    <span class="c1"># Find settling time (within 2% of final value)</span>
    <span class="n">final_val</span> <span class="o">=</span> <span class="n">y_step</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">settle_band</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">final_val</span>
    <span class="n">settled_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_step</span> <span class="o">-</span> <span class="n">final_val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">settle_band</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">settled_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">settle_time</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">settled_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">settle_time</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">controller_type</span><span class="si">}</span><span class="s2"> (Kd=</span><span class="si">{</span><span class="n">Kd</span><span class="si">}</span><span class="s2">): Overshoot = </span><span class="si">{</span><span class="n">overshoot</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, Settling time = </span><span class="si">{</span><span class="n">settle_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fe9610dfa9f4526c8be7c67ad9f84e979047674b91b5a668b3a4127cbadbb094.png" src="_images/fe9610dfa9f4526c8be7c67ad9f84e979047674b91b5a668b3a4127cbadbb094.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performance comparison (overshoot, settling time):
PI (Kd=0.0): Overshoot = 75.0%, Settling time = 5.48s
PID (Kd=0.1): Overshoot = 21.0%, Settling time = 1.02s
PID (Kd=0.2): Overshoot = 6.2%, Settling time = 0.93s
PID (Kd=0.5): Overshoot = -0.6%, Settling time = 5.49s
</pre></div>
</div>
</div>
</div>
<p><strong>Derivative benefits:</strong></p>
<ul class="simple">
<li><p>Reduces overshoot and oscillation</p></li>
<li><p>Improves damping and settling time</p></li>
<li><p>Acts like a “brake” on fast changes</p></li>
</ul>
</section>
<section id="step-4-frequency-domain-analysis">
<h3>Step 4: Frequency domain analysis<a class="headerlink" href="#step-4-frequency-domain-analysis" title="Link to this heading">#</a></h3>
<p>Let’s examine the <strong>closed-loop frequency response</strong> to understand stability margins:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare frequency responses</span>
<span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span>  <span class="c1"># Well-tuned PID</span>

<span class="c1"># Controllers</span>
<span class="n">Gc_P</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Gc_PI</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">Gc_PID</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="n">Kd</span><span class="p">,</span> <span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">controllers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">Gc_P</span><span class="p">,</span> <span class="s2">&quot;P-only&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">Gc_PI</span><span class="p">,</span> <span class="s2">&quot;PI&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">),</span> 
    <span class="p">(</span><span class="n">Gc_PID</span><span class="p">,</span> <span class="s2">&quot;PID&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Frequency range</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Magnitude plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Gc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">controllers</span><span class="p">:</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqresp</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-3 dB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [rad/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude [dB]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Closed-Loop Frequency Response&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Phase plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Gc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">controllers</span><span class="p">:</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqresp</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [rad/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase [degrees]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Closed-Loop Phase Response&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Bandwidth comparison</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Closed-loop bandwidth (-3 dB frequency):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">Gc</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">controllers</span><span class="p">:</span>
    <span class="n">T_cl</span> <span class="o">=</span> <span class="n">closed_loop_tf</span><span class="p">(</span><span class="n">Gc</span><span class="p">,</span> <span class="n">Gp</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">freqresp</span><span class="p">(</span><span class="n">T_cl</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">mag_db</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
    
    <span class="c1"># Find -3 dB point</span>
    <span class="n">idx_3db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mag_db</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_3db</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">bw</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx_3db</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">bw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">: &gt; </span><span class="si">{</span><span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> rad/s (no -3 dB point found)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/88a654b1177e8ff5c7a74f424cf4640f016788be0d5a1ed2efbf3ac67e25bac4.png" src="_images/88a654b1177e8ff5c7a74f424cf4640f016788be0d5a1ed2efbf3ac67e25bac4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Closed-loop bandwidth (-3 dB frequency):
P-only: 0.10 rad/s
PI: 3.72 rad/s
PID: 0.79 rad/s
</pre></div>
</div>
</div>
</div>
<p><strong>Summary of PID effects:</strong></p>
<ol class="arabic simple">
<li><p><strong>P</strong>: Fast response, steady-state error, potential instability</p></li>
<li><p><strong>I</strong>: Eliminates steady-state error, slower response, can cause oscillation</p></li>
<li><p><strong>D</strong>: Improves damping, reduces overshoot, increases bandwidth</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="a-simple-manual-tuning-recipe">
<h2>10. A simple manual tuning recipe<a class="headerlink" href="#a-simple-manual-tuning-recipe" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Start conservative.</strong> Set <span class="math notranslate nohighlight">\(K_i = 0\)</span>, <span class="math notranslate nohighlight">\(K_d = 0\)</span>. Increase <span class="math notranslate nohighlight">\(K_p\)</span> until the output responds quickly but without sustained oscillation.</p></li>
<li><p><strong>Add derivative.</strong> Increase <span class="math notranslate nohighlight">\(K_d\)</span> to reduce overshoot/oscillation; tune <span class="math notranslate nohighlight">\(\tau_d\)</span> so derivative is smooth (e.g., <span class="math notranslate nohighlight">\(\tau_d \approx 5\Delta t\)</span>).</p></li>
<li><p><strong>Add integral.</strong> Increase <span class="math notranslate nohighlight">\(K_i\)</span> to eliminate steady-state error; if it oscillates or recovers slowly after saturation, reduce <span class="math notranslate nohighlight">\(K_i\)</span> or lower <span class="math notranslate nohighlight">\(T_{\text{aw}}\)</span>.</p></li>
<li><p><strong>Check saturation.</strong> Ensure your actuator limits are realistic and anti-windup behaves (no long “stuck at limit” recovery).</p></li>
</ol>
<p><strong>Ziegler–Nichols (classic)</strong> (optional): set <span class="math notranslate nohighlight">\(K_i = K_d = 0\)</span>, increase <span class="math notranslate nohighlight">\(K_p\)</span> to the <strong>ultimate gain</strong> <span class="math notranslate nohighlight">\(K_u\)</span> where output sustains oscillation; note period <span class="math notranslate nohighlight">\(P_u\)</span>. Then</p>
<ul class="simple">
<li><p>P: <span class="math notranslate nohighlight">\(K_p = 0.5K_u\)</span></p></li>
<li><p>PI: <span class="math notranslate nohighlight">\(K_p = 0.45K_u, \quad K_i = 1.2K_p/P_u\)</span></p></li>
<li><p>PID: <span class="math notranslate nohighlight">\(K_p = 0.6K_u, \quad K_i = 2K_p/P_u, \quad K_d = K_pP_u/8\)</span><br />
These are aggressive; back off for robustness.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="discrete-pid-you-can-paste-into-projects">
<h2>11. Discrete PID you can paste into projects<a class="headerlink" href="#discrete-pid-you-can-paste-into-projects" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PID</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Kp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Ki</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Kd</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">tau_d</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                 <span class="n">umin</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">umax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">Taw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span> <span class="o">=</span> <span class="n">Kp</span><span class="p">,</span> <span class="n">Ki</span><span class="p">,</span> <span class="n">Kd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_d</span> <span class="o">=</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tau_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">umin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">umax</span> <span class="o">=</span> <span class="n">umin</span><span class="p">,</span> <span class="n">umax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Taw</span> <span class="o">=</span> <span class="n">Taw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integ</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_e</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_filt</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>
        <span class="c1"># integral (trapezoid)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integ</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_e</span><span class="p">)</span>
        <span class="c1"># derivative (filtered)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_d</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_d</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">d_raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_e</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d_filt</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_filt</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">d_raw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d_filt</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_e</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span>
        <span class="n">u_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kp</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ki</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">integ</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kd</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d_filt</span>
        <span class="c1"># saturation + anti-windup</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umin</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">,</span> <span class="n">u_raw</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integ</span> <span class="o">+=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_raw</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Taw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_e</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="common-pitfalls-and-quick-fixes">
<h2>12. Common pitfalls (and quick fixes)<a class="headerlink" href="#common-pitfalls-and-quick-fixes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Noisy derivative</strong> → add a small <span class="math notranslate nohighlight">\(\tau_d\)</span>, consider pre-filtering measurement <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
<li><p><strong>Sluggish after saturation</strong> → lower <span class="math notranslate nohighlight">\(K_i\)</span>, reduce <span class="math notranslate nohighlight">\(T_{\text{aw}}\)</span>, or widen limits if physically valid.</p></li>
<li><p><strong>Steady-state bias</strong> → increase <span class="math notranslate nohighlight">\(K_i\)</span> carefully or check for model/offsets; ensure sensor scale is correct.</p></li>
<li><p><strong>Discrete time too slow</strong> → decrease <span class="math notranslate nohighlight">\(\Delta t\)</span> (sample faster), retune; derivative becomes unreliable at long sample periods.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "suann124/AIinTeaching",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="student-guide.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">🚀 Student Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="simulation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interactive PID Simulation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proportional-integral-derivative-pid-control-structure">1. Proportional-Integral-Derivative (PID) Control Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-function-representation">2. Transfer Function Representation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-proportional-only-control">3. Analysis of Proportional-Only Control</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-integral-action">4. Effect of Integral Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effect-of-derivative-action">5. Effect of Derivative Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implementation-considerations">6. Practical Implementation Considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worked-example-first-order-plant">7. Worked Example: First-Order Plant</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interactive-simulation-example">8. Interactive Simulation Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-understanding-p-i-d-effects-on-a-second-order-plant">9. Experiment: Understanding P, I, D effects on a second-order plant</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-proportional-only-control">Step 1: Proportional-only control</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-adding-integral-action-pi-control">Step 2: Adding integral action (PI control)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-adding-derivative-action-full-pid">Step 3: Adding derivative action (full PID)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-frequency-domain-analysis">Step 4: Frequency domain analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-manual-tuning-recipe">10. A simple manual tuning recipe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-pid-you-can-paste-into-projects">11. Discrete PID you can paste into projects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-pitfalls-and-quick-fixes">12. Common pitfalls (and quick fixes)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Su Ann Low
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- Chat widget container (fill via extra_js if you add a widget later) -->
<div id="chat-root"></div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>